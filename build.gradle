plugins {
  id 'org.springframework.boot' version '2.1.6.RELEASE' apply false
  id 'io.spring.dependency-management' version '1.0.8.RELEASE' apply false
  id "com.jfrog.bintray" version "1.8.4" apply false
}

subprojects {
  apply plugin: 'java'
  apply plugin: 'maven-publish'
  apply plugin: 'io.spring.dependency-management'
  apply plugin: 'com.jfrog.bintray'

  group = 'uk.gov.hmcts.reform.ccd-case-migration'
  version = 'DEV-SNAPSHOT'

  sourceCompatibility = '11'
  targetCompatibility = '11'

  compileJava {
    options.compilerArgs << '-parameters' << '-Xlint:deprecation'
  }

  compileTestJava {
    options.compilerArgs << '-Xlint:deprecation'
  }

  repositories {
    mavenLocal()
    mavenCentral()

    jcenter()

    // jitpack should be last resort
    // see: https://github.com/jitpack/jitpack.io/issues/1939
    maven { url 'https://jitpack.io' }

    maven { url "https://dl.bintray.com/hmcts/hmcts-maven" }
    maven { url "http://repo.maven.apache.org/maven2" }
  }

  dependencyManagement {
    imports {
      mavenBom org.springframework.boot.gradle.plugin.SpringBootPlugin.BOM_COORDINATES
    }
  }

  def versions = [
    lombok: '1.18.8'
  ]

  dependencies {
    annotationProcessor group: 'org.projectlombok', name: 'lombok', version: versions.lombok
    compileOnly group: 'org.projectlombok', name: 'lombok', version: versions.lombok
  }

  task sourcesJar(type: Jar, dependsOn: classes) {
    classifier = 'sources'
    from sourceSets.main.allSource
  }

  publishing {
    publications {
      maven(MavenPublication) {
        from components.java
        artifact sourcesJar
      }
    }
  }

  bintray {
    user = System.getenv('BINTRAY_USER')
    key = System.getenv('BINTRAY_KEY')
    publications = ['maven']
    publish = true
    pkg {
      repo = 'hmcts-maven'
      name = 'ccd-case-migration-starter'
      userOrg = 'hmcts'
      licenses = ['MIT']
      vcsUrl = 'https://github.com/hmcts/ccd-case-migration-starter'
      version {
        name = project.version
      }
    }
  }
}
